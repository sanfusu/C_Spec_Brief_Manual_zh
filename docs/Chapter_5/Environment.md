---
Title: Environment
date: 2019-02-11 15:16:27
updated: 2019-02-11 15:16:33
---

# 环境

一个具体实现会在两个数据处理系统环境中翻译 C 源文件和执行 C 程序，在本国际标准中分别称为翻译环境(_translation environment_)和执行环境(_execution environment_)

## 程序结构

一个 C 程序不必在同一时间翻译完成。
在本国际标准中，程序文本以源文件（或者预处理文件）为单元保存。
一个源文件和其所有头文件以及通过预处理指令 `#include` 包含的源文件被称为预处理翻译单元。
预处理过后的预处理翻译单元被称为翻译单元。
先前翻译过的翻译单元可以独立保留或者保留在库中。
一个程序分离的翻译单元通过调用（操控）具有外部连系的函数（对象）或通过数据文件来进行交流。
翻译单元可以分离翻译，然后通过链接来提供可执行程序。

### 翻译阶段

翻译的语法规则之间的优先顺序有以下几个阶段规定。

1. 在必要的情况下，通过实现定义的方式将物理源文件中的多字节字符映射到原字符集（为行指示器引入换行字符）。
   三元字符序列会被相应的单字符内部表示替换
2. 删除后面紧跟换行字符的反斜杠(`\`)字符实例，然后将物理源行拼接成逻辑源行。
   任何物理源行的最后一个反斜杠才能作为这种拼接的一部分。
   非空源文件应当以换行字符结束，该换行符在任何拼接发生前不能紧跟在反斜杠后面。
3. 源文件被分解为预处理记号和空白字符序列（包括注释）。
   一个源文件不应该以部分预处理记号或部分注释结尾。
   每一个注释会被一个空白字符替换。
   换行符会被保留。
   除换行符之外的每一个非空空白字符序列是否被保留或被单个空格字符替换由具体实现定义。
4. 执行预处理指令，扩展宏调用，并执行 `_Pragma` 一元运算符表达式。
   如果通过记号连接而产生符合统一字符名语法格式的字符序列，则会造成未定义行为。
   `#include` 预处理指令会导致命名的头部或源文件从阶段 1 到阶段 4 递归的执行。
   然后，所有的预处理指令都会被删除。
5. 每一个原字符集成员和字符常量中的转义序列以及字符串字面量会被转换为相应的执行字符集成员。
   如果没有相应的成员，则会被转换为非空（宽）字符的实现定义的成员。
6. 相邻的字符串字面量记号会被连接。
7. 此时空白字符分隔记号不再重要。
   每一个预处理记号会被转换为记号。
   结果记号会通过语法和语义分析然后转换为翻译单元。
8. 所有外部的对象和函数的引用都会被解析。
   库组件会被链接，从而满足未定义在当前翻译单元中对函数和对象的外部引用。
   所有这种翻译器输出都会被收集到一个程序映像中，该映像包含在其执行环境中运行的足够信息。
